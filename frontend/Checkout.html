<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Checkout | GastroBite</title>
  <link rel="stylesheet" href="Menu.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      background: black;
      color: white;
    }
    .checkout-box {
      max-width: 550px;
      margin: 80px auto;
      background: #111;
      padding: 25px;
      border-radius: 12px;
      border: 1px solid #FFD700;
      box-shadow: 0 0 20px rgba(255,215,0,0.2);
    }
    .form-control, .form-select {
      background: #222;
      border: 1px solid #FFD700;
      color: white;
    }
    .form-control:focus, .form-select:focus {
      box-shadow: none;
      border-color: #ffdb3b;
    }
    .submit-btn {
      background: #FFD700;
      border: none;
      font-weight: bold;
      border-radius: 6px;
      padding: 10px;
      width: 100%;
      margin-top: 12px;
      color: black;
    }
    .submit-btn:hover {
      background: #e7c200;
    }
  </style>
</head>

<body>

<div class="checkout-box">
  <h2 class="text-center text-warning mb-4">Checkout</h2>

  <div class="mb-3">
    <label class="form-label">Order Type</label>
    <select id="orderType" class="form-select">
      <option value="dine-in">Dine-In</option>
      <option value="delivery">Delivery</option>
    </select>
  </div>


    <!-- Dine-In needs no input now -->
    <div id="dineInFields" style="display:none;"></div>



  <!-- Delivery Fields -->
  <div id="deliveryFields" style="display: none;">
    <label class="form-label mt-3">Delivery Address</label>
    <input type="text" id="deliveryAddress" class="form-control" placeholder="Enter Full Address">

    <label class="form-label mt-3">Contact Number</label>
    <input type="text" id="phone" class="form-control" placeholder="Enter Phone Number">
  </div>

  <button class="submit-btn" id="placeOrder">Place Order âœ…</button>
</div>


<script>
let cart = JSON.parse(localStorage.getItem("cart")) || [];
if(cart.length === 0){
  alert("Your cart is empty ðŸ˜…");
  window.location.href = "Menu.html";
}

// Switch UI on dine-in / delivery select
document.getElementById("orderType").addEventListener("change", function(){
  if(this.value === "dine-in"){
    document.getElementById("dineInFields").style.display = "block";
    document.getElementById("deliveryFields").style.display = "none";
  } else {
    document.getElementById("dineInFields").style.display = "none";
    document.getElementById("deliveryFields").style.display = "block";
  }
});

// Place Order
document.getElementById("placeOrder").onclick = async () => {

  const orderType = document.getElementById("orderType").value;
  let tableNo = null, address = null, phone = null;

  if(orderType === "dine-in"){
    tableNo = Math.floor(Math.random() * (70 - 10 + 1)) + 10;
  } else {
    address = document.getElementById("deliveryAddress").value;
    phone = document.getElementById("phone").value;

    if(!address || !phone) return alert("Complete delivery details ðŸ˜­");
  }

  // âœ… Correct total calculation
  const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);

  // âœ… Correct data sent to backend
  const orderData = { cart, orderType, tableNo, address, phone, total };

  fetch("/api/place-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(orderData)
  })
  .then(res => res.json())
  .then(data => {

    localStorage.removeItem("cart");

    if(orderType === "dine-in"){
      alert(`âœ… Order Placed!\nYour Table Number: ${tableNo}`);
    } else {
      alert("âœ… Order Placed! Delivery on the way ðŸšš");
    }

    window.location.href = "index.html";
  });
};

</script>

</body>
</html>
